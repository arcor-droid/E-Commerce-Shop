<div class="admin-order-detail-container">
  <div class="header-section">
    <button routerLink="/admin/orders" class="btn-back">← Back to Orders</button>
    <h1>Order Details</h1>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>Loading order details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button routerLink="/admin/orders" class="btn-back">Back to Orders</button>
  </div>

  <!-- Order Details -->
  <div *ngIf="!isLoading && !error && order" class="order-content">
    <!-- Order Summary Card -->
    <div class="order-summary-card">
      <div class="summary-header">
        <h2>Order #{{ order.id }}</h2>
        <span [class]="'status-badge ' + getStatusBadgeClass(order.status)">
          {{ order.status }}
        </span>
      </div>
      
      <div class="summary-info">
        <div class="info-row">
          <span class="label">Order Date:</span>
          <span class="value">{{ formatDate(order.order_date) }}</span>
        </div>
        <div class="info-row">
          <span class="label">Last Updated:</span>
          <span class="value">{{ formatDate(order.updated_at) }}</span>
        </div>
        <div class="info-row">
          <span class="label">Total Amount:</span>
          <span class="value total-amount">{{ formatCurrency(order.total) }}</span>
        </div>
      </div>
    </div>

    <!-- Customer Information Card -->
    <div class="customer-card">
      <h3>Customer Information</h3>
      <div class="customer-info">
        <div class="info-row">
          <span class="label">Name:</span>
          <span class="value">{{ order.user_nickname }}</span>
        </div>
        <div class="info-row">
          <span class="label">Email:</span>
          <span class="value">{{ order.user_email }}</span>
        </div>
        <div class="info-row">
          <span class="label">User ID:</span>
          <span class="value">#{{ order.user_id }}</span>
        </div>
      </div>
    </div>

    <!-- Order Items Card -->
    <div class="order-items-card">
      <h3>Order Items</h3>
      <div class="items-list">
        <div *ngFor="let item of order.order_items" class="order-item">
          <img [src]="getImageUrl(item.product_image)" [alt]="item.product_title" class="item-image">
          <div class="item-details">
            <h4>{{ item.product_title }}</h4>
            <p class="item-price">{{ formatCurrency(item.price) }} × {{ item.quantity }}</p>
            <p *ngIf="item.selected_options" class="item-options">
              Options: {{ item.selected_options | json }}
            </p>
          </div>
          <div class="item-total">
            {{ formatCurrency(item.price * item.quantity) }}
          </div>
        </div>
      </div>
      
      <!-- Order Totals -->
      <div class="order-totals">
        <div class="total-row">
          <span>Subtotal:</span>
          <span>{{ formatCurrency(order.subtotal) }}</span>
        </div>
        <div class="total-row">
          <span>Tax:</span>
          <span>{{ formatCurrency(order.tax) }}</span>
        </div>
        <div class="total-row">
          <span>Shipping:</span>
          <span>{{ formatCurrency(order.shipping_cost) }}</span>
        </div>
        <div class="total-row final-total">
          <span>Total:</span>
          <span>{{ formatCurrency(order.total) }}</span>
        </div>
      </div>
    </div>

    <!-- Status Management Card -->
    <div class="status-management-card">
      <h3>Manage Order Status</h3>
      
      <div class="status-form">
        <div class="form-group">
          <label for="statusSelect">Order Status:</label>
          <select id="statusSelect" [(ngModel)]="selectedStatus" [disabled]="isUpdating" class="status-select">
            <option *ngFor="let status of ORDER_STATUSES" [value]="status">
              {{ status }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="adminNotes">Admin Notes (optional):</label>
          <textarea 
            id="adminNotes" 
            [(ngModel)]="adminNotes"
            [disabled]="isUpdating"
            placeholder="Add notes about this status change..."
            rows="3"
            class="notes-textarea"></textarea>
        </div>

        <button 
          (click)="updateOrderStatus()" 
          [disabled]="isUpdating || selectedStatus === order.status"
          class="btn-update">
          {{ isUpdating ? 'Updating...' : 'Update Status' }}
        </button>
      </div>

      <!-- Existing Admin Notes -->
      <div *ngIf="order.admin_notes" class="existing-notes">
        <h4>Previous Admin Notes:</h4>
        <pre>{{ order.admin_notes }}</pre>
      </div>

      <!-- Customer Notes -->
      <div *ngIf="order.customer_notes" class="customer-notes">
        <h4>Customer Notes:</h4>
        <p>{{ order.customer_notes }}</p>
      </div>
    </div>
  </div>
</div>
